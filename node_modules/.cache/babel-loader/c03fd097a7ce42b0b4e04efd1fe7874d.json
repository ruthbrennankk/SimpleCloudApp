{"remainingRequest":"/Users/ruthbrennan/WebstormProjects/ia2/node_modules/babel-loader/lib/index.js!/Users/ruthbrennan/WebstormProjects/ia2/node_modules/eslint-loader/index.js??ref--13-0!/Users/ruthbrennan/WebstormProjects/ia2/src/main.js","dependencies":[{"path":"/Users/ruthbrennan/WebstormProjects/ia2/src/main.js","mtime":1607101627164},{"path":"/Users/ruthbrennan/WebstormProjects/ia2/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/ruthbrennan/WebstormProjects/ia2/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/ruthbrennan/WebstormProjects/ia2/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:cmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lm1hcCIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5jb25zdHJ1Y3RvciIpOwoKcmVxdWlyZSgiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaXRlcmF0b3IiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc3RhcnRzLXdpdGgiKTsKCnJlcXVpcmUoImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIik7CgpyZXF1aXJlKCJyZWdlbmVyYXRvci1ydW50aW1lL3J1bnRpbWUiKTsKCnZhciBfYXN5bmNUb0dlbmVyYXRvciA9IHJlcXVpcmUoIi9Vc2Vycy9ydXRoYnJlbm5hbi9XZWJzdG9ybVByb2plY3RzL2lhMi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9hc3luY1RvR2VuZXJhdG9yIik7CgpyZXF1aXJlKCIvVXNlcnMvcnV0aGJyZW5uYW4vV2Vic3Rvcm1Qcm9qZWN0cy9pYTIvbm9kZV9tb2R1bGVzL0B2dWUvYmFiZWwtcHJlc2V0LWFwcC9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5Lml0ZXJhdG9yLmpzIik7CgpyZXF1aXJlKCIvVXNlcnMvcnV0aGJyZW5uYW4vV2Vic3Rvcm1Qcm9qZWN0cy9pYTIvbm9kZV9tb2R1bGVzL0B2dWUvYmFiZWwtcHJlc2V0LWFwcC9ub2RlX21vZHVsZXMvY29yZS1qcy9tb2R1bGVzL2VzLnByb21pc2UuanMiKTsKCnJlcXVpcmUoIi9Vc2Vycy9ydXRoYnJlbm5hbi9XZWJzdG9ybVByb2plY3RzL2lhMi9ub2RlX21vZHVsZXMvQHZ1ZS9iYWJlbC1wcmVzZXQtYXBwL25vZGVfbW9kdWxlcy9jb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmFzc2lnbi5qcyIpOwoKcmVxdWlyZSgiL1VzZXJzL3J1dGhicmVubmFuL1dlYnN0b3JtUHJvamVjdHMvaWEyL25vZGVfbW9kdWxlcy9AdnVlL2JhYmVsLXByZXNldC1hcHAvbm9kZV9tb2R1bGVzL2NvcmUtanMvbW9kdWxlcy9lcy5wcm9taXNlLmZpbmFsbHkuanMiKTsKCnZhciBTRVJWRVJfUE9SVCA9IDgwMDE7Cgp2YXIgZXhwcmVzcyA9IHJlcXVpcmUoImV4cHJlc3MiKTsKCnZhciBhcHAgPSBleHByZXNzKCk7Cgp2YXIgY29ycyA9IHJlcXVpcmUoImNvcnMiKTsKCnZhciBBV1MgPSByZXF1aXJlKCJhd3Mtc2RrIik7CgpBV1MuY29uZmlnLnVwZGF0ZSh7CiAgcmVnaW9uOiAndXMtZWFzdC0xJwp9KTsKdmFyIEFXU19CVUNLRVQgPSAiY3N1NDQwMDBhc3NpZ24ydXNlYXN0MjAiOwp2YXIgQVdTX0ZJTEVOQU1FID0gIm1vdmllZGF0YS5qc29uIjsKdmFyIFRBQkxFID0gIk1vdmllcyI7CnZhciBzMyA9IG5ldyBBV1MuUzMoKTsgLy9keW5hbW9EQiBib2lsZXJwbGF0ZQoKdmFyIGJ1Y2tldFBhcmFtcyA9IHsKICBCdWNrZXQ6IEFXU19CVUNLRVQsCiAgS2V5OiBBV1NfRklMRU5BTUUKfTsKdmFyIGR5bmFtb0RCID0gbmV3IEFXUy5EeW5hbW9EQigpOwp2YXIgZGJQYXJhbXMgPSB7CiAgVGFibGVOYW1lOiBUQUJMRSwKICBLZXlTY2hlbWE6IFt7CiAgICBBdHRyaWJ1dGVOYW1lOiAieWVhciIsCiAgICBLZXlUeXBlOiAiSEFTSCIKICB9LCAvL1BhcnRpdGlvbiBrZXkKICB7CiAgICBBdHRyaWJ1dGVOYW1lOiAidGl0bGUiLAogICAgS2V5VHlwZTogIlJBTkdFIgogIH0gLy9Tb3J0IGtleQogIF0sCiAgQXR0cmlidXRlRGVmaW5pdGlvbnM6IFt7CiAgICBBdHRyaWJ1dGVOYW1lOiAieWVhciIsCiAgICBBdHRyaWJ1dGVUeXBlOiAiTiIKICB9LCB7CiAgICBBdHRyaWJ1dGVOYW1lOiAidGl0bGUiLAogICAgQXR0cmlidXRlVHlwZTogIlMiCiAgfV0sCiAgQmlsbGluZ01vZGU6ICJQQVlfUEVSX1JFUVVFU1QiCn07CmFwcC51c2UoY29ycygpKTsgLy9BbGxvdyBjcm9zcyBvcmlnaW4gcmVxdWVzdHMgZm9yIGxvY2FsIGRldmVsb3BtZW50CgphcHAudXNlKGV4cHJlc3Muc3RhdGljKCdwdWJsaWMnKSk7IC8vc2VydmUgdGhlIHdlYnBhZ2UKLy90aGlzIGZlYXR1cmUgaXMgY29taW5nIG5hdGl2ZWx5IGluIEV4cHJlc3MgNQovL0V4cHJlc3MgNSBpcyBjdXJyZW50bHkgaW4gQWxwaGEgc28gdGhpcyB3aWxsIGRvIGZvciBub3cKLy9jYXRjaGVzIGFzeW5jIGVycm9ycyBhbmQgcGFzc2VzIHRoZW0gdG8gdGhlIGVycm9yIGhhbmRsaW5nIGZuIGRlZmluZWQgYXQgdGhlIGVuZAoKZnVuY3Rpb24gYXN5bmNFcnJXcmFwcGVyKGFzeW5jRnVuKSB7CiAgcmV0dXJuIGZ1bmN0aW9uIChyZXEsIHJlcywgbmV4dCkgewogICAgYXN5bmNGdW4ocmVxLCByZXMsIG5leHQpLmNhdGNoKG5leHQpOwogIH07Cn0gLy9yZXR1cm5zIGEgcHJvbWlzZSBvYmplY3QgZnJvbSB0aGUgczMgYnVja2V0CgoKZnVuY3Rpb24gZ2V0RnJvbVMzQnVja2V0KCkgewogIHJldHVybiBzMy5nZXRPYmplY3QoYnVja2V0UGFyYW1zKS5wcm9taXNlKCk7Cn0gLy93cml0ZSB0aGUgb2JqZWN0IHRvIHRoZSBkYgoKCmZ1bmN0aW9uIHdyaXRlVG9EeW5hbW8obW92aWVEYXRhKSB7CiAgdmFyIGRvY0NsaWVudCA9IG5ldyBBV1MuRHluYW1vREIuRG9jdW1lbnRDbGllbnQoKTsKICBtb3ZpZURhdGEubWFwKGZ1bmN0aW9uIChtb3ZpZSkgewogICAgdmFyIHBhcmFtcyA9IHsKICAgICAgVGFibGVOYW1lOiBUQUJMRSwKICAgICAgSXRlbTogewogICAgICAgICJ5ZWFyIjogbW92aWUueWVhciwKICAgICAgICAidGl0bGUiOiBtb3ZpZS50aXRsZSwKICAgICAgICAiaW5mbyI6IG1vdmllLmluZm8KICAgICAgfQogICAgfTsKICAgIHJldHVybiBkb2NDbGllbnQucHV0KHBhcmFtcywgZnVuY3Rpb24gKGVyciwgZGF0YSkgewogICAgICBpZiAoZXJyKSB7CiAgICAgICAgY29uc29sZS5lcnJvcigiVW5hYmxlIHRvIGFkZCBtb3ZpZSIsIG1vdmllLnRpdGxlLCAiLiBFcnJvciBKU09OOiIsIEpTT04uc3RyaW5naWZ5KGVyciwgbnVsbCwgMikpOwogICAgICB9CiAgICB9KS5wcm9taXNlKCk7CiAgfSk7CiAgcmV0dXJuIG1vdmllRGF0YTsKfSAvL3F1ZXJ5cyB0aGUgZGF0YWJhc2UKCgpmdW5jdGlvbiBxdWVyeURCKHllYXIsIHRpdGxlKSB7CiAgdmFyIHF1ZXJ5UGFyYW1zID0gewogICAgVGFibGVOYW1lOiBUQUJMRSwKICAgIEtleUNvbmRpdGlvbkV4cHJlc3Npb246ICIjeXIgPSA6eXl5eSBhbmQgYmVnaW5zX3dpdGgodGl0bGUsIDp0aXRsZVN0YXJ0KSIsCiAgICBFeHByZXNzaW9uQXR0cmlidXRlTmFtZXM6IHsKICAgICAgIiN5ciI6ICJ5ZWFyIgogICAgfSwKICAgIEV4cHJlc3Npb25BdHRyaWJ1dGVWYWx1ZXM6IHsKICAgICAgIjp5eXl5IjogeWVhciwKICAgICAgIjp0aXRsZVN0YXJ0IjogdGl0bGUKICAgIH0KICB9OwogIHZhciBkb2NDbGllbnQgPSBuZXcgQVdTLkR5bmFtb0RCLkRvY3VtZW50Q2xpZW50KCk7CiAgcmV0dXJuIGRvY0NsaWVudC5xdWVyeShxdWVyeVBhcmFtcykucHJvbWlzZSgpOwp9CgphcHAuZ2V0KCIvbW92aWUiLCBhc3luY0VycldyYXBwZXIoIC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgdmFyIF9yZWYgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUocmVxLCByZXMpIHsKICAgIHZhciBkYlJlczsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICB3aGlsZSAoMSkgewogICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDI7CiAgICAgICAgICAgIHJldHVybiBxdWVyeURCKE51bWJlcihyZXEucXVlcnkueWVhciksIHJlcS5xdWVyeS50aXRsZSk7CgogICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICBkYlJlcyA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgIHJlcy5zZW5kKGRiUmVzLkl0ZW1zKTsKCiAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZSk7CiAgfSkpOwoKICByZXR1cm4gZnVuY3Rpb24gKF94LCBfeDIpIHsKICAgIHJldHVybiBfcmVmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgfTsKfSgpKSk7CmFwcC5kZWxldGUoIi9kYXRhYmFzZSIsIGFzeW5jRXJyV3JhcHBlciggLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICB2YXIgX3JlZjIgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKF8sIHJlcykgewogICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgY29uc29sZS5sb2coIkRlbGV0aW5nIERhdGFiYXNlIik7CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gMzsKICAgICAgICAgICAgcmV0dXJuIGR5bmFtb0RCLmRlbGV0ZVRhYmxlKHsKICAgICAgICAgICAgICBUYWJsZU5hbWU6IFRBQkxFCiAgICAgICAgICAgIH0pLnByb21pc2UoKTsKCiAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNTsKICAgICAgICAgICAgcmV0dXJuIGR5bmFtb0RCLndhaXRGb3IoInRhYmxlTm90RXhpc3RzIiwgewogICAgICAgICAgICAgIFRhYmxlTmFtZTogVEFCTEUKICAgICAgICAgICAgfSkucHJvbWlzZSgpOwoKICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgY29uc29sZS5sb2coIkRhdGFiYXNlIGRlbGV0ZWQiKTsKICAgICAgICAgICAgcmVzLnN0YXR1cygyMDApLnNlbmQoIkRhdGFiYXNlIGRlbGV0ZWQiKTsKCiAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIF9jYWxsZWUyKTsKICB9KSk7CgogIHJldHVybiBmdW5jdGlvbiAoX3gzLCBfeDQpIHsKICAgIHJldHVybiBfcmVmMi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogIH07Cn0oKSkpOwphcHAucG9zdCgiL2RhdGFiYXNlIiwgYXN5bmNFcnJXcmFwcGVyKCAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIHZhciBfcmVmMyA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoXywgcmVzLCBuZXh0KSB7CiAgICB2YXIgcmVzcG9uc2VfanNvbjsKICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7CiAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJDcmVhdGluZyBEYXRhYmFzZSIpOwogICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDM7CiAgICAgICAgICAgIHJldHVybiBkeW5hbW9EQi5jcmVhdGVUYWJsZShkYlBhcmFtcykucHJvbWlzZSgpOwoKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgX2NvbnRleHQzLm5leHQgPSA1OwogICAgICAgICAgICByZXR1cm4gZHluYW1vREIud2FpdEZvcigidGFibGVFeGlzdHMiLCB7CiAgICAgICAgICAgICAgVGFibGVOYW1lOiBUQUJMRQogICAgICAgICAgICB9KS5wcm9taXNlKCk7CgogICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICBfY29udGV4dDMudDAgPSBKU09OOwogICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDg7CiAgICAgICAgICAgIHJldHVybiBnZXRGcm9tUzNCdWNrZXQoKTsKCiAgICAgICAgICBjYXNlIDg6CiAgICAgICAgICAgIF9jb250ZXh0My50MSA9IF9jb250ZXh0My5zZW50LkJvZHk7CiAgICAgICAgICAgIHJlc3BvbnNlX2pzb24gPSBfY29udGV4dDMudDAucGFyc2UuY2FsbChfY29udGV4dDMudDAsIF9jb250ZXh0My50MSk7CiAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMTI7CiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLmFsbCh3cml0ZVRvRHluYW1vKHJlc3BvbnNlX2pzb24pKTsKCiAgICAgICAgICBjYXNlIDEyOgogICAgICAgICAgICBjb25zb2xlLmxvZygiRGF0YWJhc2UgQ3JlYXRlZCEiKTsKICAgICAgICAgICAgcmVzLnN0YXR1cygyMDApLnNlbmQoIkRhdGFiYXNlIENyZWF0ZWQhIik7CgogICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgIH0KICAgICAgfQogICAgfSwgX2NhbGxlZTMpOwogIH0pKTsKCiAgcmV0dXJuIGZ1bmN0aW9uIChfeDUsIF94NiwgX3g3KSB7CiAgICByZXR1cm4gX3JlZjMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICB9Owp9KCkpKTsgLy9oYW5kbGVzIGFzeW5jIGVycm9ycwoKYXBwLnVzZShmdW5jdGlvbiAoZXJyLCByZXEsIHJlcywgbmV4dCkgewogIGNvbnNvbGUuZXJyb3IoZXJyKTsKICBpZiAoZXJyICE9PSBudWxsICYmIGVyciAhPT0gdm9pZCAwICYmIGVyci5tZXNzYWdlLnN0YXJ0c1dpdGgoIlRhYmxlIGFscmVhZHkgZXhpc3RzIikpIHJldHVybiByZXMuc3RhdHVzKDIxMCkuc2VuZCgiVGFibGUgYWxyZWFkeSBleGlzdHMiKTtlbHNlIGlmIChlcnIgIT09IG51bGwgJiYgZXJyICE9PSB2b2lkIDAgJiYgZXJyLm1lc3NhZ2Uuc3RhcnRzV2l0aCgiUmVxdWVzdGVkIHJlc291cmNlIG5vdCBmb3VuZDogVGFibGU6IikpIHJldHVybiByZXMuc3RhdHVzKDIxMCkuc2VuZCgiVGFibGUgYWxyZWFkeSBkZWxldGVkIik7CiAgcmVzLnN0YXR1cyg1MDApLnNlbmQoZXJyKTsKfSk7CmFwcC5saXN0ZW4oU0VSVkVSX1BPUlQsIGZ1bmN0aW9uICgpIHsKICByZXR1cm4gY29uc29sZS5sb2coIlNlcnZlciBydW5uaW5nIG9uIHBvcnQ6ICIuY29uY2F0KFNFUlZFUl9QT1JUKSk7Cn0pOw=="},{"version":3,"sources":["/Users/ruthbrennan/WebstormProjects/ia2/src/main.js"],"names":["SERVER_PORT","express","require","app","cors","AWS","config","update","region","AWS_BUCKET","AWS_FILENAME","TABLE","s3","S3","bucketParams","Bucket","Key","dynamoDB","DynamoDB","dbParams","TableName","KeySchema","AttributeName","KeyType","AttributeDefinitions","AttributeType","BillingMode","use","static","asyncErrWrapper","asyncFun","req","res","next","catch","getFromS3Bucket","getObject","promise","writeToDynamo","movieData","docClient","DocumentClient","map","movie","params","Item","year","title","info","put","err","data","console","error","JSON","stringify","queryDB","queryParams","KeyConditionExpression","ExpressionAttributeNames","ExpressionAttributeValues","query","get","Number","dbRes","send","Items","delete","_","log","deleteTable","waitFor","status","post","createTable","Body","response_json","parse","Promise","all","message","startsWith","listen"],"mappings":"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","sourcesContent":["const SERVER_PORT = 8001;\nconst express = require(\"express\");\nconst app = express();\nconst cors = require(\"cors\");\nconst AWS = require(\"aws-sdk\");\nAWS.config.update({\n  region: 'us-east-1'\n});\n\nconst AWS_BUCKET = \"csu44000assign2useast20\";\nconst AWS_FILENAME = \"moviedata.json\";\nconst TABLE = \"Movies\";\n\nconst s3 = new AWS.S3();\n\n//dynamoDB boilerplate\nconst bucketParams = {\n  Bucket: AWS_BUCKET,\n  Key: AWS_FILENAME\n};\n\nlet dynamoDB = new AWS.DynamoDB();\nlet dbParams = {\n  TableName: TABLE,\n  KeySchema: [\n    { AttributeName: \"year\", KeyType: \"HASH\" },  //Partition key\n    { AttributeName: \"title\", KeyType: \"RANGE\" }  //Sort key\n  ],\n  AttributeDefinitions: [\n    { AttributeName: \"year\", AttributeType: \"N\" },\n    { AttributeName: \"title\", AttributeType: \"S\" }\n  ],\n  BillingMode: \"PAY_PER_REQUEST\"\n};\n\napp.use(cors()); //Allow cross origin requests for local development\napp.use(express.static('public')); //serve the webpage\n\n//this feature is coming natively in Express 5\n//Express 5 is currently in Alpha so this will do for now\n//catches async errors and passes them to the error handling fn defined at the end\nfunction asyncErrWrapper(asyncFun) {\n  return function (req, res, next) {\n    asyncFun(req, res, next).catch(next);\n  };\n}\n\n//returns a promise object from the s3 bucket\nfunction getFromS3Bucket() {\n  return s3.getObject(bucketParams).promise();\n}\n\n//write the object to the db\nfunction writeToDynamo(movieData) {\n  let docClient = new AWS.DynamoDB.DocumentClient();\n  movieData.map(function (movie) {\n    let params = {\n      TableName: TABLE,\n      Item: {\n        \"year\": movie.year,\n        \"title\": movie.title,\n        \"info\": movie.info\n      }\n    };\n    return docClient.put(params, function (err, data) {\n      if (err) {\n        console.error(\"Unable to add movie\", movie.title, \". Error JSON:\", JSON.stringify(err, null, 2));\n      }\n    }).promise();\n  });\n  return movieData;\n}\n\n//querys the database\nfunction queryDB(year, title) {\n  let queryParams = {\n    TableName: TABLE,\n    KeyConditionExpression: \"#yr = :yyyy and begins_with(title, :titleStart)\",\n    ExpressionAttributeNames: {\n      \"#yr\": \"year\"\n    },\n    ExpressionAttributeValues: {\n      \":yyyy\": year,\n      \":titleStart\": title\n    }\n  };\n\n  let docClient = new AWS.DynamoDB.DocumentClient();\n  return docClient.query(queryParams).promise();\n}\n\napp.get(\"/movie\", asyncErrWrapper(async (req, res) => {\n  let dbRes = await queryDB(Number(req.query.year), req.query.title);\n  res.send(dbRes.Items);\n}));\n\napp.delete(\"/database\", asyncErrWrapper(async (_, res) => {\n  console.log(\"Deleting Database\");\n  await dynamoDB.deleteTable({ TableName: TABLE }).promise();\n  await dynamoDB.waitFor(\"tableNotExists\", {TableName: TABLE}).promise();\n  console.log(\"Database deleted\");\n  res.status(200).send(\"Database deleted\");\n}));\n\napp.post(\"/database\", asyncErrWrapper(async (_, res, next) => {\n  console.log(\"Creating Database\");\n  await dynamoDB.createTable(dbParams).promise();\n  await dynamoDB.waitFor(\"tableExists\", {TableName: TABLE}).promise();\n  let response_json = JSON.parse((await getFromS3Bucket()).Body);\n  await Promise.all(writeToDynamo(response_json));\n  console.log(\"Database Created!\");\n  res.status(200).send(\"Database Created!\");\n}));\n\n//handles async errors\napp.use((err, req, res, next) => {\n  console.error(err);\n  if (err?.message.startsWith(\"Table already exists\"))\n    return res.status(210).send(\"Table already exists\");\n  else if (err?.message.startsWith(\"Requested resource not found: Table:\"))\n    return res.status(210).send(\"Table already deleted\");\n  res.status(500).send(err);\n});\n\napp.listen(SERVER_PORT, () => console.log(`Server running on port: ${SERVER_PORT}`));"]}]}